# Spacetime Trivia

> A massively-multiplayer, real-time trivia party game designed for instant fun, social interaction, and infinite, AI-generated content.

Welcome to Spacetime Trivia! This project aims to deliver a lightning-fast, highly engaging trivia experience that scales to thousands of concurrent players and offers an ever-expanding universe of questions.

> This game is a result of [brainstorming with o3](https://chatgpt.com/share/681a2b1f-0c1c-8000-b1b7-0dac2c2efb3e).

---

## Core Features

Based on our [SPECS.md](SPECS.md), the key goals are:

1.  **🚀 Instant Play**: Join a game and start answering questions in under 5 seconds on a typical 4G connection.
2.  **🏟️ Massive Rooms**: A single game lobby can comfortably host up to 10,000 concurrent players.
3.  **⚡ Social Energy**: Experience the thrill of seeing other players' actions and choices in real-time (sub-100ms latency).
4.  **🧠 Infinite Content**: Trivia questions are automatically generated by an LLM worker, with quality continuously refined by community feedback.
5.  **🛠️ Extensible Platform**: Players can create and publish custom "agents" (bots, mini-game modes) to enhance or modify the gameplay.

For a deeper dive into the player experience and specific use-cases, check out our [Jobs-To-Be-Done (JTBD.md)](JTBD.md) document.

---

## Tech Stack

Our infrastructure is designed for scalability, low latency, and rapid development:

*   **Frontend**: Next.js (React) with TypeScript, Tailwind CSS. Deployed on Vercel.
*   **Backend Game Logic**: SpacetimeDB (Rust module) for authoritative game state and real-time data synchronization via WebSockets.
*   **AI Question Generation**: Cloudflare Workers AI orchestrated by Cloudflare Workflows (`LLM-Worker`).
*   **Data Storage & ETL**:
    *   Cloudflare R2 for storing nightly feedback datasets (JSONL).
    *   Cloudflare KV for pointers (e.g., latest dataset version).
    *   Cloudflare Workflows for the daily feedback ETL pipeline.
*   **Database**: SpacetimeDB also serves as the primary database for game entities.

*For a visual overview, see Section 7 (Infrastructure Diagram) in [SPECS.md](SPECS.md).*

---

## Getting Started (Local Development)

To get the project running locally for development:

1.  **Prerequisites**:
    *   Node.js (latest LTS) and pnpm
    *   Rust toolchain (`rustup`)
    *   Docker Desktop (or Docker engine)
    *   SpacetimeDB CLI (refer to official SpacetimeDB documentation for installation)

2.  **Clone the repository**:
    ```bash
    git clone <repository-url>
    cd spacetime-trivia
    ```

3.  **Backend (SpacetimeDB Module)**:
    *   Navigate to the SpacetimeDB module directory (e.g., `stdb_module/`).
    *   Run local SpacetimeDB instance (typically using Docker as outlined in `TODO.md` or SpacetimeDB docs):
        ```bash
        # Example command, adapt as per your setup
        spacetime start --config path/to/your/spacetime.toml
        # Or, if using the planned Docker setup:
        docker-compose up stdb
        ```
    *   Build and publish your module:
        ```bash
        cargo build --release
        spacetime publish --db-name spacetime_trivia_dev path/to/your/module.wasm
        ```
        *(Refer to `TODO.md` and `SPECS.md` for specific module names and commands as they are finalized).*

4.  **Frontend (Next.js Client)**:
    *   Navigate to the `client/` directory:
        ```bash
        cd client
        ```
    *   Install dependencies:
        ```bash
        pnpm install
        ```
    *   Set up environment variables. Create a `.env.local` file in the `client/` directory. You'll likely need to point to your local SpacetimeDB instance:
        ```env
        NEXT_PUBLIC_SPACETIMEDB_URL=ws://localhost:<your-stdb-port>
        NEXT_PUBLIC_SPACETIMEDB_DB_NAME=spacetime_trivia_dev
        # Add other necessary variables
        ```
    *   Run the development server:
        ```bash
        pnpm dev
        ```
    *   Open [http://localhost:3000](http://localhost:3000) in your browser.

5.  **Cloudflare Workers/Workflows (Optional for core game loop initially)**:
    *   For features involving AI question generation or feedback ETL, you'll need to set up `wrangler` and deploy the respective Cloudflare components.
    *   Refer to `SPECS.md` (Section 5 & 10) and official Cloudflare documentation.

---

## Project Structure

```
spacetime-trivia/
├── client/                  # Next.js frontend application
│   ├── app/                 # Next.js App Router (pages, layouts)
│   ├── components/          # React components (screens, UI blocks, modals)
│   ├── hooks/               # Custom React hooks
│   ├── lib/                 # Utility functions, library configurations
│   ├── public/              # Static assets
│   ├── styles/              # Global styles, Tailwind CSS config
│   ├── next.config.mjs
│   ├── package.json
│   └── tsconfig.json
├── stdb_module/             # SpacetimeDB Rust module (game logic, reducers, tables)
│   ├── src/
│   ├── Cargo.toml
│   └── ...
├── .github/                 # GitHub Actions workflows (CI)
├── SPECS.md                 # Detailed functional & technical specification
├── JTBD.md                  # Jobs-To-Be-Done user stories
├── TODO.md                  # Engineering backlog and task management
└── README.md                # This file
```
*(Note: The `stdb_module/` directory name is an example; the actual name might differ.)*

---

## Key Specification Documents

*   **[SPECS.md](SPECS.md)**: The single source of truth for functional requirements, data models, reducer contracts, infrastructure, and more.
*   **[JTBD.md](JTBD.md)**: Outlines the "jobs" our product aims to satisfy for key user personas, driving feature development.
*   **[TODO.md](TODO.md)**: A living engineering backlog, tracking tasks, priorities, and ownership.

---

## Contributing

We welcome contributions! Please follow these guidelines:

1.  **Understand the Specs**: Before diving into code, familiarize yourself with `SPECS.md` and `JTBD.md`.
2.  **Check the Backlog**: Pick up tasks from `TODO.md` or propose new ones. Ensure an owner is assigned.
3.  **Branching**: Create a new branch for each feature or bugfix (e.g., `feature/J-1-instant-play` or `fix/U-3-crowd-meter-glitch`).
4.  **Development Workflow**:
    *   Follow the local development setup guide.
    *   Write unit tests for backend logic (`cargo test`).
    *   Ensure frontend code is linted (`pnpm lint`).
5.  **Pull Requests (PRs)**:
    *   Submit PRs against the `main` branch (or a designated development branch).
    *   Ensure your PR passes CI checks (linting, tests).
    *   PRs that modify `SPECS.md`, `JTBD.md`, or `TODO.md` must also pass review.
    *   Squash commits for a clean merge history if necessary.
6.  **Coding Style**: Follow existing code style and conventions. For `TODO.md` updates, adhere to the syntax rules outlined within that file.

If you have questions, reach out to the project maintainers or the owner of the relevant task in `TODO.md`.

---

Happy Hacking! ✨